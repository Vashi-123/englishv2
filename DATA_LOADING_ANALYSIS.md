# –ê–Ω–∞–ª–∏–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å

## –û–±–∑–æ—Ä

–ü—Ä–∏ –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ù–∏–∂–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

## –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ AppContent

### 1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

#### 1.1. useAvailableLevels
- **–ó–∞–ø—Ä–æ—Å**: `supabase.rpc('get_available_levels')` –∏–ª–∏ `supabase.from('lesson_scripts').select('level')`
- **–ö–æ–≥–¥–∞**: –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- **–ö—ç—à**: –ù–µ—Ç
- **Realtime**: –î–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è lesson_scripts)

#### 1.2. useCourseModules
- **–ó–∞–ø—Ä–æ—Å**: `supabase.from('course_modules').select('*').eq('level', level).eq('lang', lang)`
- **–ö–æ–≥–¥–∞**: –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç level –∏ lang
- **–ö—ç—à**: sessionStorage (`englishv2:courseModules:${level}:${lang}`)
- **Realtime**: –ù–µ—Ç

#### 1.3. useDayPlans
- **–ó–∞–ø—Ä–æ—Å**: `supabase.from('lesson_scripts').select('lesson_id, day, lesson, theme, level').eq('level', level)`
- **–ö–æ–≥–¥–∞**: –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- **–ö—ç—à**: sessionStorage (`englishv2:dayPlans:${level}`)
- **Realtime**: –î–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è lesson_scripts)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ú–æ–∂–µ—Ç —Ä–µ—Ç—Ä–∞–∏—Ç—å –¥–æ 4 —Ä–∞–∑ –ø—Ä–∏ –æ—à–∏–±–∫–µ (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

#### 1.4. useFreePlan
- **–ó–∞–ø—Ä–æ—Å**: `supabase.from('billing_products').select('key,active,lesson_access_limit').eq('key', 'free_default')`
- **–ö–æ–≥–¥–∞**: –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- **–ö—ç—à**: localStorage (`englishv2:billing:freeLessonLimit`)
- **Realtime**: –î–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è billing_products)

#### 1.5. useEntitlements
- **–ó–∞–ø—Ä–æ—Å**: `supabase.from('user_entitlements').select('user_id,is_premium,premium_until').eq('user_id', userId)`
- **–ö–æ–≥–¥–∞**: –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç userId
- **–ö—ç—à**: –ù–µ—Ç
- **Realtime**: –î–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è user_entitlements)

### 2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞)

#### 2.1. loadAllDaysStatusAndSelectCurrent
**–ü—Ä–æ–±–ª–µ–º–∞**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è

```typescript
// –®–∞–≥ 1: –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –¥–Ω–µ–π (—Ö–æ—Ä–æ—à–æ)
const progressByLessonId = await loadLessonProgressByLessonIds(lessonIds, level);

// –®–∞–≥ 2: –¶–∏–∫–ª —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–ø–ª–æ—Ö–æ!)
for (const dayPlan of dayPlans) {
  if (!completedFromProgress && shouldVerify) {
    // –ó–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –¥–Ω—è
    const hasTag = await hasLessonCompleteTag(dayPlan.day, dayPlan.lesson, level);
    // ...
  }
}
```

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤**:
- 1 –∑–∞–ø—Ä–æ—Å: `loadLessonProgressByLessonIds` (–±–∞—Ç—á–∏–Ω–≥ –≤—Å–µ—Ö –¥–Ω–µ–π)
- N –∑–∞–ø—Ä–æ—Å–æ–≤: `hasLessonCompleteTag` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –¥–Ω—è (–¥–æ –ø–µ—Ä–≤–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ)
- **–ò—Ç–æ–≥–æ**: 1 + N –∑–∞–ø—Ä–æ—Å–æ–≤, –≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π –¥–æ –ø–µ—Ä–≤–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ú–æ–∂–Ω–æ –±–∞—Ç—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ `hasLessonCompleteTag` –≤ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å `IN` —Ñ–∏–ª—å—Ç—Ä–æ–º.

#### 2.2. getAllUserWords
- **–ó–∞–ø—Ä–æ—Å**: `supabase.from('user_srs_cards').select('id, word, translation').eq('level', level).eq('source_lang', 'en').eq('target_lang', targetLang)`
- **–ö–æ–≥–¥–∞**: –ü–æ—Å–ª–µ `isInitializing === false`
- **–ö—ç—à**: –ù–µ—Ç
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –ñ–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

#### 2.3. loadGrammarCards
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞

```typescript
for (const plan of dayPlans) {
  // –ó–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ!
  const scriptJson = await loadLessonScript(plan.day, plan.lesson, level);
  // ...
}
```

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤**: N –∑–∞–ø—Ä–æ—Å–æ–≤, –≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –ø–ª–∞–Ω–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å 100+)

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ú–æ–∂–Ω–æ –±–∞—Ç—á–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Ö –ª–µ–Ω–∏–≤–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏.

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)

#### 3.1. checkLessonCompletion
- **–ó–∞–ø—Ä–æ—Å**: `loadLessonProgress` + –≤–æ–∑–º–æ–∂–Ω–æ `hasLessonCompleteTag` + –≤–æ–∑–º–æ–∂–Ω–æ `loadChatMessages`
- **–ö–æ–≥–¥–∞**: –ü—Ä–∏ —Å–º–µ–Ω–µ view –Ω–∞ DASHBOARD
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: 1-3 –∑–∞–ø—Ä–æ—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

#### 3.2. Prefetch –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
- **–ó–∞–ø—Ä–æ—Å**: `prefetchLessonScript` + `loadLessonProgress` + `loadChatMessages`
- **–ö–æ–≥–¥–∞**: –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: 3 –∑–∞–ø—Ä–æ—Å–∞

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –≤—Ö–æ–¥–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–≤—Å–µ —É—Ä–æ–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –∫—ç—à –ø—É—Å—Ç)
1. `get_available_levels` - 1 –∑–∞–ø—Ä–æ—Å
2. `course_modules` - 1 –∑–∞–ø—Ä–æ—Å
3. `lesson_scripts` (dayPlans) - 1 –∑–∞–ø—Ä–æ—Å
4. `billing_products` - 1 –∑–∞–ø—Ä–æ—Å
5. `user_entitlements` - 1 –∑–∞–ø—Ä–æ—Å
6. `lesson_progress` (–±–∞—Ç—á–∏–Ω–≥ –≤—Å–µ—Ö –¥–Ω–µ–π) - 1 –∑–∞–ø—Ä–æ—Å
7. `user_srs_cards` - 1 –∑–∞–ø—Ä–æ—Å
8. `lesson_scripts` (grammar, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è) - N –∑–∞–ø—Ä–æ—Å–æ–≤

**–ò—Ç–æ–≥–æ**: 7 + N –∑–∞–ø—Ä–æ—Å–æ–≤, –≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–º–æ–∂–µ—Ç –±—ã—Ç—å 100+)

### –¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏)
–î–æ–±–∞–≤–ª—è–µ—Ç—Å—è:
- `hasLessonCompleteTag` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –¥–Ω—è –¥–æ –ø–µ—Ä–≤–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ

**–ò—Ç–æ–≥–æ**: 7 + N + M –∑–∞–ø—Ä–æ—Å–æ–≤, –≥–¥–µ:
- N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–¥–ª—è grammar)
- M = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π –¥–æ –ø–µ—Ä–≤–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ

## –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **loadGrammarCards - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ 100+ —Å–∫—Ä–∏–ø—Ç–æ–≤**
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≥—Ä–∞–º–º–∞—Ç–∏–∫—É –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤ —Å—Ä–∞–∑—É
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ —Ü–∏–∫–ª–µ
   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç UI –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ –¥–æ–ª–≥–æ
   - **–†–µ—à–µ–Ω–∏–µ**: –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏ –∏–ª–∏ –±–∞—Ç—á–∏–Ω–≥

2. **hasLessonCompleteTag - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ü–∏–∫–ª–µ**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –¥–Ω—è –¥–µ–ª–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   - **–†–µ—à–µ–Ω–∏–µ**: –ë–∞—Ç—á–∏–Ω–≥ —Å `IN` —Ñ–∏–ª—å—Ç—Ä–æ–º –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

3. **–ù–µ—Ç –±–∞—Ç—á–∏–Ω–≥–∞ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
   - –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤ –æ–¥–∏–Ω RPC –≤—ã–∑–æ–≤

4. **loadGrammarCards –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –º–æ–¥–∞–ª–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è**
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è
   - **–†–µ—à–µ–Ω–∏–µ**: –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### üü¢ –ú–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

5. **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è getAllUserWords**
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ —Å–º–µ–Ω–µ level/language
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à –≤ sessionStorage

6. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ realtime –ø–æ–¥–ø–∏—Å–∫–∏**
   - –ö–∞–∂–¥—ã–π —Ö—É–∫ —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ—é –ø–æ–¥–ø–∏—Å–∫—É
   - –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–Ω—É –ø–æ–¥–ø–∏—Å–∫—É —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ë–∞—Ç—á–∏–Ω–≥ hasLessonCompleteTag**
   ```sql
   -- –í–º–µ—Å—Ç–æ N –∑–∞–ø—Ä–æ—Å–æ–≤:
   SELECT DISTINCT lesson_id 
   FROM chat_messages 
   WHERE user_id = $1 
     AND lesson_id IN ($2, $3, ..., $N)
     AND text ILIKE '%<lesson_complete>%'
   ```

2. **–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ grammar cards**
   - –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏
   - –ò–ª–∏ –±–∞—Ç—á–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –°—Ä–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

3. **RPC –¥–ª—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   ```sql
   CREATE FUNCTION get_user_dashboard_data(user_id UUID, level TEXT)
   RETURNS JSON AS $$
   -- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
   $$;
   ```

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ getAllUserWords**
   - –î–æ–±–∞–≤–∏—Ç—å sessionStorage –∫—ç—à
   - –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —á–µ—Ä–µ–∑ realtime

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ú–µ–ª–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

5. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ realtime –ø–æ–¥–ø–∏—Å–æ–∫**
   - –û–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö

6. **Prefetch —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –£–±—Ä–∞—Ç—å prefetch –¥–ª—è grammar, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

```
App.tsx (AppContent)
‚îú‚îÄ‚îÄ useAvailableLevels ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îú‚îÄ‚îÄ useCourseModules ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îú‚îÄ‚îÄ useDayPlans ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
‚îú‚îÄ‚îÄ useFreePlan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îî‚îÄ‚îÄ useEntitlements ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îú‚îÄ‚îÄ loadAllDaysStatusAndSelectCurrent
    ‚îÇ   ‚îú‚îÄ‚îÄ loadLessonProgressByLessonIds (1 –∑–∞–ø—Ä–æ—Å) ‚úÖ
    ‚îÇ   ‚îî‚îÄ‚îÄ hasLessonCompleteTag (N –∑–∞–ø—Ä–æ—Å–æ–≤) ‚ùå
    ‚îÇ
    ‚îú‚îÄ‚îÄ getAllUserWords (–ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
    ‚îÇ
    ‚îî‚îÄ‚îÄ loadGrammarCards
        ‚îî‚îÄ‚îÄ loadLessonScript (N –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ) ‚ùå
```

## –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏**: ~500-1000ms (7 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ grammar**: ~5-10 —Å–µ–∫—É–Ω–¥ (100+ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- **–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤**: ~1-3 —Å–µ–∫—É–Ω–¥—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π)

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ—Ü–µ–Ω–∫–∞)
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏**: ~300-500ms (–±–∞—Ç—á–∏–Ω–≥ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ grammar**: ~0ms (–ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞) –∏–ª–∏ ~500ms (–±–∞—Ç—á–∏–Ω–≥)
- **–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤**: ~200-500ms (–±–∞—Ç—á–∏–Ω–≥ –ø—Ä–æ–≤–µ—Ä–æ–∫)

## –í—ã–≤–æ–¥—ã

1. **–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ grammar cards –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤
2. **–í—Ç–æ—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã hasLessonCompleteTag –≤ —Ü–∏–∫–ª–µ
3. **–•–æ—Ä–æ—à–æ**: –ë–∞—Ç—á–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—Ä–æ–∫–æ–≤ —á–µ—Ä–µ–∑ loadLessonProgressByLessonIds
4. **–•–æ—Ä–æ—à–æ**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Ö—É–∫–∏

## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∞—Ç—á–∏–Ω–≥ –¥–ª—è hasLessonCompleteTag
2. ‚úÖ –°–¥–µ–ª–∞—Ç—å –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É grammar cards
3. ‚è≥ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å RPC –¥–ª—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è getAllUserWords

